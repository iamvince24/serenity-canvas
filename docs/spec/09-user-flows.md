# 使用情境與操作流程 (User Flows)

> 定義主要使用情境的操作步驟與預期畫面狀態，作為 UI 設計的依據。

---

## Flow 1：首次使用（未登入）

**情境**：使用者第一次造訪，想快速體驗白板功能。

| 步驟 | 使用者操作         | 系統回應                             | 畫面狀態                                     |
| ---- | ------------------ | ------------------------------------ | -------------------------------------------- |
| 1    | 開啟網站首頁       | 顯示 Landing Page，含「開始使用」CTA | Landing Page                                 |
| 2    | 點擊「開始使用」   | 建立一個空白白板，資料存入 IndexedDB | 空白畫布，顯示引導提示（如「雙擊新增卡片」） |
| 3    | 雙擊畫布空白處     | 新增一張文字卡片，進入編輯模式       | 畫布上出現卡片，游標聚焦於卡片內             |
| 4    | 輸入 Markdown 內容 | 即時預覽 Markdown 格式               | 卡片高度隨內容自動延展                       |
| 5    | 點擊卡片外部       | 退出編輯模式，卡片顯示為預覽狀態     | 卡片顯示渲染後的 Markdown                    |

**備註**：未登入使用者僅限 1 個白板，無收件匣與剪藏功能。頁面應適時提示登入以解鎖完整功能。

---

## Flow 2：註冊與登入

**情境**：使用者想保存白板資料並使用進階功能。

| 步驟 | 使用者操作                 | 系統回應                                           | 畫面狀態                                         |
| ---- | -------------------------- | -------------------------------------------------- | ------------------------------------------------ |
| 1    | 點擊右上角「登入」按鈕     | 顯示登入 Modal                                     | Modal 含 Google OAuth 按鈕與 Email/Password 表單 |
| 2a   | 點擊「以 Google 登入」     | 跳轉 Google OAuth 流程                             | Google 授權頁面                                  |
| 2b   | 輸入 Email/Password 後送出 | Supabase Auth 驗證                                 | 表單驗證回饋（成功/錯誤）                        |
| 3    | 授權/驗證完成              | 將本地 IndexedDB 資料同步至 Supabase，解鎖完整功能 | 白板頁面，側邊欄出現收件匣，可建立多個白板       |

---

## Flow 3：Chrome 剪藏 → 收件匣 → 白板

**情境**：登入使用者在瀏覽網頁時，看到有用的內容想收集到白板中。

| 步驟 | 使用者操作                        | 系統回應                                                   | 畫面狀態                           |
| ---- | --------------------------------- | ---------------------------------------------------------- | ---------------------------------- |
| 1    | 在網頁上選取一段文字              | 文字反白                                                   | 瀏覽器頁面                         |
| 2    | 右鍵 → 「剪藏至 Serenity Canvas」 | Extension 彈出目的地選單                                   | 右鍵選單 → Extension 子選單        |
| 3    | 選擇「送至收件匣」                | Extension 呼叫後端 API，將內容 + URL + Title 存入 Supabase | 瀏覽器右上角顯示成功通知           |
| 4    | 切換到 Web App                    | 收件匣自動更新（或手動重整）                               | 側邊欄收件匣顯示新卡片，含來源標註 |
| 5    | 將收件匣卡片拖曳至白板            | 卡片從收件匣移除，在白板上建立對應的文字卡片               | 白板新增卡片，收件匣少一張         |

**替代路徑**：步驟 3 也可選擇直接送至「指定白板」，跳過收件匣。

---

## Flow 4：白板編輯與整理

**情境**：使用者已收集多張卡片，要在白板上進行視覺化整理。

### 4a：卡片操作

| 步驟 | 使用者操作       | 系統回應                                  | 畫面狀態                   |
| ---- | ---------------- | ----------------------------------------- | -------------------------- |
| 1    | 拖曳卡片至新位置 | 卡片跟隨滑鼠移動，自動儲存新位置          | 卡片移動中                 |
| 2    | 拖拉卡片右側邊緣 | 調整卡片寬度，高度自動適應                | 卡片寬度改變，內容重新排版 |
| 3    | 點擊卡片顏色選單 | 顯示 6 種顏色選項（對應 Obsidian Canvas） | 顏色選擇器                 |
| 4    | 選擇顏色         | 卡片邊框/背景更新為選取的顏色             | 卡片顏色改變               |

### 4b：建立連線

| 步驟 | 使用者操作             | 系統回應                   | 畫面狀態                                   |
| ---- | ---------------------- | -------------------------- | ------------------------------------------ |
| 1    | 滑鼠移至卡片邊緣       | 顯示連線錨點               | 卡片四邊出現小圓點                         |
| 2    | 從錨點拖曳至另一張卡片 | 顯示連線預覽               | 虛線跟隨滑鼠                               |
| 3    | 放開滑鼠於目標卡片     | 建立連線，預設為單向箭頭   | 兩張卡片之間出現連線                       |
| 4    | 點擊連線               | 顯示連線設定（方向、標籤） | 連線工具列：單向/雙向/無箭頭、文字標籤輸入 |

### 4c：群組操作

| 步驟 | 使用者操作           | 系統回應             | 畫面狀態                             |
| ---- | -------------------- | -------------------- | ------------------------------------ |
| 1    | 在空白處按住滑鼠拖曳 | 顯示框選範圍         | 半透明矩形選取框                     |
| 2    | 框選多張卡片後放開   | 選取的卡片高亮       | 被選取的卡片顯示選取外框             |
| 3    | 右鍵 →「建立群組」   | 將選取的卡片包進群組 | 卡片外圍出現群組邊框，可設定群組名稱 |

### 4d：Undo / Redo

| 操作 | 快捷鍵                 | 行為                                       |
| ---- | ---------------------- | ------------------------------------------ |
| 復原 | `Cmd/Ctrl + Z`         | 還原上一步操作（移動、編輯、連線、刪除等） |
| 重做 | `Cmd/Ctrl + Shift + Z` | 重做已復原的操作                           |

---

## Flow 5：匯出至 Obsidian

**情境**：使用者整理完畢，要將白板內容匯出到 Obsidian Vault。

| 步驟 | 使用者操作                                | 系統回應                                                  | 畫面狀態                        |
| ---- | ----------------------------------------- | --------------------------------------------------------- | ------------------------------- |
| 1    | 點擊工具列「匯出」按鈕                    | 顯示匯出設定 Modal                                        | Modal 含匯出預覽（檔案清單）    |
| 2    | 確認匯出設定                              | 開始打包：卡片 → `.md`、畫布 → `.canvas`、圖片 → 原檔下載 | 進度指示器（Processing...）     |
| 3    | 打包完成                                  | 自動下載 `.zip` 檔案                                      | 下載完成提示                    |
| 4    | 使用者將 zip 解壓至 Obsidian Vault 資料夾 | —                                                         | Obsidian 中可開啟 Canvas 與筆記 |

**備註**：匯出為單向操作，不支援從 Obsidian 匯入。打包在 Web Worker 中執行，不阻塞 UI。

---

## Flow 6：AI 輔助排版（Phase 3）

**情境**：使用者白板上有許多卡片，希望 AI 協助自動排版與建議關聯。

| 步驟 | 使用者操作                      | 系統回應                                  | 畫面狀態                                    |
| ---- | ------------------------------- | ----------------------------------------- | ------------------------------------------- |
| 1    | 點擊工具列「AI 排版」按鈕       | 彈出 API Key 設定（首次使用）或確認對話框 | Modal：輸入 Gemini API Key（首次使用時）    |
| 2    | 輸入 API Key → 點擊「開始排版」 | 將卡片內容送至後端，後端呼叫 LLM          | 畫布進入「排版中」狀態，顯示 loading 動畫   |
| 3    | SSE streaming 回傳結果          | 卡片逐步移動到 AI 建議的位置              | 卡片漸進式移動動畫                          |
| 4    | AI 建議連線關係                 | 顯示建議的連線（虛線預覽）                | 虛線連線 + 標籤，區別於使用者手動建立的實線 |
| 5    | 使用者確認或調整                | 確認 → 連線變為實線；取消 → 移除建議      | 最終排版結果                                |

**備註**：Gemini API Key 儲存於客戶端（localStorage），不傳至後端儲存。整個過程可 Undo 還原至排版前狀態。

---

## Flow 7：多白板管理（登入使用者）

**情境**：使用者有多個主題，需要分別管理。

| 步驟 | 使用者操作                    | 系統回應              | 畫面狀態                                         |
| ---- | ----------------------------- | --------------------- | ------------------------------------------------ |
| 1    | 點擊左上角「白板清單」或 Logo | 顯示白板列表頁        | 卡片式列表，顯示白板名稱、最後編輯時間、卡片數量 |
| 2    | 點擊「新增白板」              | 建立空白白板並進入    | 空白畫布                                         |
| 3    | 點擊既有白板                  | 載入該白板資料        | 上次編輯時的畫布狀態                             |
| 4    | 右鍵白板卡片 →「刪除」        | 確認對話框 → 刪除白板 | 白板列表更新                                     |
